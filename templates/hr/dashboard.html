{% extends "base.html" %}
{% block title %}Dashboard - AccountWorks{% endblock %}

{% block content %}

<style>
  /* ‡πÅ‡∏ï‡πà‡∏á‡πÇ‡∏ó‡∏ô‡πÇ‡∏°‡πÄ‡∏î‡∏¥‡∏£‡πå‡∏ô ‡πÄ‡∏ö‡∏≤ ‡πÜ */
  .aw-section-title{font-weight:700;}
  .aw-card{
    border:0; border-radius:18px;
    box-shadow:0 8px 24px rgba(0,0,0,.08);
  }
  .aw-metric{
    display:flex; align-items:center; gap:14px;
  }
  .aw-metric .icon{
    width:44px;height:44px;border-radius:12px;display:flex;
    align-items:center;justify-content:center;font-size:20px;
    background:rgba(13,110,253,.1); color:#0d6efd;
  }
  .aw-badge{
    padding:.35rem .6rem; border-radius:999px; font-weight:600; font-size:.8rem;
  }
  .aw-badge.approved{background:#e6f6ec;color:#198754;}
  .aw-badge.pending{background:#fff4e5;color:#b85a00;}
  .aw-badge.rejected{background:#fde8ea;color:#c12b3a;}
  .table > :not(caption) > * > * { background-color:transparent; }
  .btn-soft{
    border-radius:12px; font-weight:600;
    box-shadow:0 6px 16px rgba(13,110,253,.12);
  }
  .subtle{color:#6c757d}
</style>

<!-- Header -->
<div class="d-flex align-items-center justify-content-between mb-4">
  <div>
    <h2 class="aw-section-title mb-1">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ, {{ request.user.first_name|default:request.user.username }}</h2>
    <div class="subtle">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</div>
  </div>
  <div class="d-none d-md-block">
    <a href="{% url 'leave_request' %}" class="btn btn-primary btn-soft">+ ‡∏¢‡∏∑‡πà‡∏ô‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏•‡∏≤</a>
  </div>
</div>

<div class="row g-4">

  <!-- Metrics -->
  <div class="col-12 col-lg-8">
    <div class="card aw-card">
      <div class="card-body p-4">
        <div class="d-flex align-items-center justify-content-between mb-3">
          <h5 class="mb-0">‡πÇ‡∏Ñ‡∏ß‡∏ï‡πâ‡∏≤‡∏ß‡∏±‡∏ô‡∏•‡∏≤‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</h5>
          <span class="subtle">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î ‚Ä¢ {{ now|date:"j M Y, H:i" }}</span>
        </div>

        <div class="row g-3">
          <div class="col-12 col-md-4">
            <div class="aw-metric p-3 rounded" style="background:linear-gradient(135deg,#eef4ff,#f7f9ff);">
              <div class="icon"><span>üìÖ</span></div>
              <div>
                <div class="subtle">Annual leave</div>
                <div class="h4 mb-0">{{ balance.annual_leave|default:0 }}</div>
              </div>
            </div>
          </div>
          <div class="col-12 col-md-4">
            <div class="aw-metric p-3 rounded" style="background:linear-gradient(135deg,#e9fbf3,#f7fffb);">
              <div class="icon" style="background:rgba(25,135,84,.1);color:#198754;">ü©∫</div>
              <div>
                <div class="subtle">Sick leave</div>
                <div class="h4 mb-0">{{ balance.sick_leave|default:0 }}</div>
              </div>
            </div>
          </div>
          <div class="col-12 col-md-4">
            <div class="aw-metric p-3 rounded" style="background:linear-gradient(135deg,#fff3f7,#fff8fb);">
              <div class="icon" style="background:rgba(214,51,132,.12);color:#d63384;">üßç</div>
              <div>
                <div class="subtle">Personal leave</div>
                <div class="h4 mb-0">{{ balance.personal_leave|default:0 }}</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Chart -->
        <div class="row mt-4">
          <div class="col-12">
            <canvas id="leaveChart" height="86"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick actions & tips -->
  <div class="col-12 col-lg-4">
    <div class="card aw-card mb-4">
      <div class="card-body p-4">
        <h5 class="mb-3">‡∏ó‡∏≤‡∏á‡∏•‡∏±‡∏î</h5>
        <div class="d-grid gap-2">
          <a class="btn btn-primary btn-soft" href="{% url 'leave_request' %}">+ ‡∏¢‡∏∑‡πà‡∏ô‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏•‡∏≤</a>
          <a class="btn btn-outline-secondary btn-soft" href="{% url 'leave_dashboard' %}">‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏•‡∏≤</a>
          <a class="btn btn-outline-secondary btn-soft" href="{% url 'menu_holidays' %}">‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó</a>
        </div>
      </div>
    </div>

    <div class="card aw-card">
      <div class="card-body p-4">
        <h6 class="mb-2">‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö</h6>
        <div class="subtle">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏¢‡∏≤‡∏ß‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û</div>
      </div>
    </div>
  </div>

  <!-- Requests table -->
  <div class="col-12">
    <div class="card aw-card">
      <div class="card-body p-4">
        <div class="d-flex align-items-center justify-content-between mb-3">
          <h5 class="mb-0">‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏•‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h5>
          <a href="{% url 'leave_request' %}" class="btn btn-primary btn-soft btn-sm">+ ‡∏¢‡∏∑‡πà‡∏ô‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏•‡∏≤</a>
        </div>

        {% if leave_requests %}
          <div class="table-responsive">
            <table class="table align-middle">
              <thead class="subtle">
                <tr>
                  <th scope="col">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                  <th scope="col">‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                  <th scope="col" class="text-center">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                </tr>
              </thead>
              <tbody>
              {% for r in leave_requests %}
                <tr>
                  <td class="fw-semibold">
                    {% if r.leave_type == 'annual' %}Annual{% elif r.leave_type == 'sick' %}Sick{% else %}Personal{% endif %}
                  </td>
                  <td>{{ r.start_date|date:"j M Y" }} ‚Üí {{ r.end_date|date:"j M Y" }}</td>
                  <td class="text-center">
                    {% if r.status == 'approved' %}
                      <span class="aw-badge approved">approved</span>
                    {% elif r.status == 'rejected' %}
                      <span class="aw-badge rejected">rejected</span>
                    {% else %}
                      <span class="aw-badge pending">pending</span>
                    {% endif %}
                  </td>
                </tr>
              {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <div class="text-center py-4 subtle">
            ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏•‡∏≤ ‡∏•‡∏≠‡∏á‡∏Å‡∏î ‚Äú‡∏¢‡∏∑‡πà‡∏ô‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏•‡∏≤‚Äù ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ üëç
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
  (() => {
    const ctx = document.getElementById('leaveChart');
    if (!ctx) return;

    const annual = Number("{{ balance.annual_leave|default:0 }}");
    const sick = Number("{{ balance.sick_leave|default:0 }}");
    const personal = Number("{{ balance.personal_leave|default:0 }}");

    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Annual', 'Sick', 'Personal'],
        datasets: [{
          label: '‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (‡∏ß‡∏±‡∏ô)',
          data: [annual, sick, personal],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: {
          y: { beginAtZero: true, ticks: { stepSize: 1 } }
        }
      }
    });
  })();
</script>

{% endblock %}
