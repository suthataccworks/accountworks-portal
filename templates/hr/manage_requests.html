{% extends "base.html" %}
{% block title %}อนุมัติคำขอลา{% endblock %}

{% block content %}
<style>
  .aw-card{border:0;border-radius:18px;box-shadow:0 10px 28px rgba(0,0,0,.08);}
  .badge-status{font-weight:700;border-radius:999px;padding:.35rem .65rem}
  .status-approved{background:rgba(25,135,84,.12);color:#198754;border:1px solid rgba(25,135,84,.25)}
  .status-pending{background:rgba(255,193,7,.18);color:#b78103;border:1px solid rgba(255,193,7,.35)}
  .status-rejected{background:rgba(220,53,69,.12);color:#dc3545;border:1px solid rgba(220,53,69,.28)}
</style>

<div class="d-flex align-items-center justify-content-between mb-3">
  <h2 class="m-0">อนุมัติคำขอลา</h2>
  <div class="btn-group">
    <a class="btn btn-outline-secondary {% if not show_all and status == 'pending' %}active{% endif %}" href="?status=pending">Pending</a>
    <a class="btn btn-outline-secondary {% if not show_all and status == 'approved' %}active{% endif %}" href="?status=approved">Approved</a>
    <a class="btn btn-outline-secondary {% if not show_all and status == 'rejected' %}active{% endif %}" href="?status=rejected">Rejected</a>
    <a class="btn btn-outline-primary {% if show_all %}active{% endif %}" href="?all=1">ดูทั้งหมด</a>
  </div>
</div>

<div class="card aw-card">
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table mb-0 align-middle">
        <thead class="table-light">
          <tr>
            <th style="width:18rem">พนักงาน</th>
            <th style="width:9rem">ประเภท</th>
            <th style="width:22rem">ช่วงวันที่ลา</th>
            <th>เหตุผล</th>
            <th style="width:10rem">สถานะ</th>
            <th style="width:12rem" class="text-end">การดำเนินการ</th>
          </tr>
        </thead>
        <tbody>
          {% for r in items %}
            <tr>
              <td>
                <div class="fw-semibold">{{ r.employee.user.get_full_name|default:r.employee.user.username }}</div>
                <div class="text-muted small">@{{ r.employee.user.username }}</div>
              </td>
              <td>{{ r.get_leave_type_display }}</td>
              <td class="text-nowrap">{{ r.start_date|date:"j M Y" }} → {{ r.end_date|date:"j M Y" }}</td>
              <td class="text-truncate" style="max-width:360px;">
                {% if r.reason %}{{ r.reason }}{% else %}<span class="text-muted">-</span>{% endif %}
              </td>
              <td>
                {% if r.status == "approved" %}
                  <span class="badge badge-status status-approved">approved</span>
                {% elif r.status == "pending" %}
                  <span class="badge badge-status status-pending">pending</span>
                {% else %}
                  <span class="badge badge-status status-rejected">rejected</span>
                {% endif %}
              </td>
              <td class="text-end">
                <form method="post" class="d-inline">
                  {% csrf_token %}
                  <input type="hidden" name="pk" value="{{ r.pk }}">
                  <button name="action" value="approve" class="btn btn-success btn-sm" {% if r.status != 'pending' %}disabled{% endif %}>อนุมัติ</button>
                </form>
                <form method="post" class="d-inline">
                  {% csrf_token %}
                  <input type="hidden" name="pk" value="{{ r.pk }}">
                  <button name="action" value="reject" class="btn btn-outline-danger btn-sm" {% if r.status != 'pending' %}disabled{% endif %}>ปฏิเสธ</button>
                </form>
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="6" class="text-center py-4 text-muted">ไม่พบคำขอลาตามเงื่อนไข</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
